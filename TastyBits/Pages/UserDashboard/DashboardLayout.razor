@inherits LayoutComponentBase
@using Microsoft.AspNetCore.Identity;
@using TastyBits.Pages.UserDashboard.Components
@using TastyBits.Services;
@inject LoggedUserService loggedUser;


<MudThemeProvider Theme="MyCustomTheme"/>
<MudDialogProvider CloseButton="true" />
<MudSnackbarProvider />

<div class="flex min-h-screen">
    <MudLayout>
        <MudAppBar>
            <MudIconButton Icon="@Icons.Material.Filled.Menu" Color="Color.Inherit" Edge="Edge.Start" OnClick="@ToggleDrawer" />
            <MudSpacer></MudSpacer>
            @if (_demoMode) {
                <div class="p-3 bg-amber-300 text-gray-50 flex justify-center mr-40 rounded-lg">
                    <p class="text-lg text-emerald-800">Demo</p>
                </div>
            }
            <MudText  Color="Color.Dark">@userEmail</MudText>
        </MudAppBar>
        <MudDrawer Color="Color.Transparent" Open="open" Width="20rem">
            <DashboardNav Class="col-start-1 w-50"></DashboardNav>
        </MudDrawer>
        <MudMainContent>
            <main id="rightDashboardLayout" class="col-start-2 grow">
                <div class="p-5">
                    @Body
                </div>
            </main>
        </MudMainContent>
    </MudLayout>
</div>

@code {
    MudTheme MyCustomTheme = new MudTheme()
        {
            Palette = new PaletteLight()
            {
                Primary = "#10b981",
                Secondary = "#6ee7b7",
                AppbarBackground = "#6ee7b7",
                Success = "#059669",
                Error = "#d64545",
                Warning = "#f59e0b",
                Info = "#6b7280",
                GrayDark = "#333333"
            }
        };

    bool open = true;

    void ToggleDrawer()
    {
        open = !open;
    }

    private string userEmail { get; set; }
    private bool _demoMode { get; set; }
    protected override async Task OnInitializedAsync()
    {
        var user = await loggedUser.GetUserDataAsync();
        userEmail = user.Email;
        _demoMode = await loggedUser.IsCurrentUserDemo();
    }
}
